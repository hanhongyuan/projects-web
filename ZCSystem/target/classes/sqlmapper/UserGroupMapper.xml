<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.unisk.zc.mapper.UserGroupMapper">
	<resultMap id="BaseResultMap" type="com.unisk.zc.entitys.UserGroup">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="ID" property="id" jdbcType="INTEGER" />
		<result column="GROUPNAME" property="groupname" jdbcType="VARCHAR" />
		<result column="PARENTID" property="parentid" jdbcType="INTEGER" />
		<result column="GROUPNO" property="groupno" jdbcType="CHAR" />
		<result column="ALLOWDEL" property="allowdel" jdbcType="INTEGER" />
		<result column="ALLOWEDIT" property="allowedit" jdbcType="INTEGER" />
		<result column="SORTCODE" property="sortcode" jdbcType="INTEGER" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="DELMARK" property="delmark" jdbcType="INTEGER" />
		<result column="CREATETIME" property="createtime" jdbcType="TIMESTAMP" />
		<result column="CREATEUSERID" property="createuserid" jdbcType="INTEGER" />
		<result column="MODIFYTIME" property="modifytime" jdbcType="TIMESTAMP" />
		<result column="MODIFYUSERID" property="modifyuserid" jdbcType="INTEGER" />
		<result column="WECHATSTATUS" property="wechatstatus"  jdbcType="INTEGER" />
	</resultMap>
	<resultMap type="java.util.Map" id="PageResultMap" extends="BaseResultMap"></resultMap>
	<sql id="Base_Column_List">
		ID, GROUPNAME, PARENTID, GROUPNO, ALLOWDEL, ALLOWEDIT, SORTCODE,
		REMARKS, DELMARK,
		CREATETIME, CREATEUSERID, MODIFYTIME, MODIFYUSERID,WECHATSTATUS
	</sql>
	<sql id="selectListSql">
		select
		<include refid="Base_Column_List" />
		,(case WECHATSTATUS
	    	when 0 then '未同步'
	    	when 1 then '已同步'
	    	when 2 then '更新失败'
	    	when 3 then '更新成功' 
	    	else ''
	     end) WECHATSTATUSLABEL,
	     (select p.GROUPNAME from TB_D_USERGROUP p where p.id=c.PARENTID) GROUPNAMELABEL
		from TB_D_USERGROUP c
		where DELMARK = 0
		<if test="groupname != null">
			and GROUPNAME LIKE CONCAT(CONCAT('%', #{groupname,jdbcType=VARCHAR}), '%')
		</if>
		<if test="queryMap != null and queryMap.startTime != null">
			and CREATETIME > #{queryMap.startTime,jdbcType=TIMESTAMP}
		</if>
	</sql>
	
	<select id="selectList" resultType="list" resultMap="PageResultMap" parameterType="com.unisk.zc.entitys.UserGroup">
		<include refid="selectListSql"></include>
	</select>
	
	<select id="selectListByPage" resultType="list" resultMap="PageResultMap" parameterType="com.unisk.zc.entitys.UserGroup">
		<include refid="selectListSql"></include>
	</select>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from TB_D_USERGROUP
		where ID = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update TB_D_USERGROUP set DELMARK=1 where ID = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.unisk.zc.entitys.UserGroup" keyProperty="id" useGeneratedKeys="true">
		insert into TB_D_USERGROUP (ID, GROUPNAME, PARENTID,
		GROUPNO, ALLOWDEL, ALLOWEDIT,
		SORTCODE, REMARKS, DELMARK,
		CREATETIME, CREATEUSERID, MODIFYTIME,
		MODIFYUSERID,WECHATSTATUS)
		values (#{id,jdbcType=INTEGER},
		#{groupname,jdbcType=VARCHAR},
		#{parentid,jdbcType=INTEGER},
		#{groupno,jdbcType=CHAR}, #{allowdel,jdbcType=INTEGER},
		#{allowedit,jdbcType=INTEGER},
		#{sortcode,jdbcType=INTEGER},
		#{remarks,jdbcType=VARCHAR},
		#{delmark,jdbcType=INTEGER},
		#{createtime,jdbcType=TIMESTAMP}, #{createuserid,jdbcType=INTEGER},
		#{modifytime,jdbcType=TIMESTAMP},
		#{modifyuserid,jdbcType=INTEGER},#{wechatstatus,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.unisk.zc.entitys.UserGroup" keyProperty="id" useGeneratedKeys="true">
		insert into TB_D_USERGROUP
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				ID,
			</if>
			<if test="groupname != null">
				GROUPNAME,
			</if>
			<if test="parentid != null">
				PARENTID,
			</if>
			<if test="groupno != null">
				GROUPNO,
			</if>
			<if test="allowdel != null">
				ALLOWDEL,
			</if>
			<if test="allowedit != null">
				ALLOWEDIT,
			</if>
			<if test="sortcode != null">
				SORTCODE,
			</if>
			<if test="remarks != null">
				REMARKS,
			</if>
			<if test="delmark != null">
				DELMARK,
			</if>
			<if test="createtime != null">
				CREATETIME,
			</if>
			<if test="createuserid != null">
				CREATEUSERID,
			</if>
			<if test="modifytime != null">
				MODIFYTIME,
			</if>
			<if test="modifyuserid != null">
				MODIFYUSERID,
			</if>
			<if test="wechatstatus != null">
		      	WECHATSTATUS,
		    </if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="groupname != null">
				#{groupname,jdbcType=VARCHAR},
			</if>
			<if test="parentid != null">
				#{parentid,jdbcType=INTEGER},
			</if>
			<if test="groupno != null">
				#{groupno,jdbcType=CHAR},
			</if>
			<if test="allowdel != null">
				#{allowdel,jdbcType=INTEGER},
			</if>
			<if test="allowedit != null">
				#{allowedit,jdbcType=INTEGER},
			</if>
			<if test="sortcode != null">
				#{sortcode,jdbcType=INTEGER},
			</if>
			<if test="remarks != null">
				#{remarks,jdbcType=VARCHAR},
			</if>
			<if test="delmark != null">
				#{delmark,jdbcType=INTEGER},
			</if>
			<if test="createtime != null">
				#{createtime,jdbcType=TIMESTAMP},
			</if>
			<if test="createuserid != null">
				#{createuserid,jdbcType=INTEGER},
			</if>
			<if test="modifytime != null">
				#{modifytime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyuserid != null">
				#{modifyuserid,jdbcType=INTEGER},
			</if>
			<if test="wechatstatus != null">
		      	#{wechatstatus,jdbcType=INTEGER},
		    </if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.unisk.zc.entitys.UserGroup">
		update TB_D_USERGROUP
		<set>
			<if test="groupname != null">
				GROUPNAME = #{groupname,jdbcType=VARCHAR},
			</if>
			<if test="parentid != null">
				PARENTID = #{parentid,jdbcType=INTEGER},
			</if>
			<if test="groupno != null">
				GROUPNO = #{groupno,jdbcType=CHAR},
			</if>
			<if test="allowdel != null">
				ALLOWDEL = #{allowdel,jdbcType=INTEGER},
			</if>
			<if test="allowedit != null">
				ALLOWEDIT = #{allowedit,jdbcType=INTEGER},
			</if>
			<if test="sortcode != null">
				SORTCODE = #{sortcode,jdbcType=INTEGER},
			</if>
			<if test="remarks != null">
				REMARKS = #{remarks,jdbcType=VARCHAR},
			</if>
			<if test="delmark != null">
				DELMARK = #{delmark,jdbcType=INTEGER},
			</if>
			<if test="createtime != null">
				CREATETIME = #{createtime,jdbcType=TIMESTAMP},
			</if>
			<if test="createuserid != null">
				CREATEUSERID = #{createuserid,jdbcType=INTEGER},
			</if>
			<if test="modifytime != null">
				MODIFYTIME = #{modifytime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyuserid != null">
				MODIFYUSERID = #{modifyuserid,jdbcType=INTEGER},
			</if>
			<if test="wechatstatus != null">
		      	WECHATSTATUS = #{wechatstatus,jdbcType=INTEGER},
		    </if>
		</set>
		where ID = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.unisk.zc.entitys.UserGroup">
		update TB_D_USERGROUP
		set GROUPNAME = #{groupname,jdbcType=VARCHAR},
		PARENTID = #{parentid,jdbcType=INTEGER},
		GROUPNO = #{groupno,jdbcType=CHAR},
		ALLOWDEL = #{allowdel,jdbcType=INTEGER},
		ALLOWEDIT = #{allowedit,jdbcType=INTEGER},
		SORTCODE = #{sortcode,jdbcType=INTEGER},
		REMARKS = #{remarks,jdbcType=VARCHAR},
		DELMARK = #{delmark,jdbcType=INTEGER},
		CREATETIME = #{createtime,jdbcType=TIMESTAMP},
		CREATEUSERID = #{createuserid,jdbcType=INTEGER},
		MODIFYTIME = #{modifytime,jdbcType=TIMESTAMP},
		MODIFYUSERID = #{modifyuserid,jdbcType=INTEGER},
		WECHATSTATUS = #{wechatstatus,jdbcType=INTEGER}
		where ID = #{id,jdbcType=INTEGER}
	</update>

	<select id="selectUGSubjectRolesListPage" resultType="list"
		resultMap="BaseResultMap" parameterType="com.unisk.zc.entitys.UserGroup">
		SELECT
		u.`GROUPNAME`,u.`ID`,u.`REMARKS`  FROM
		TB_R_SUBJECT_AND_ROLES t LEFT JOIN
		TB_D_USERGROUP u ON
		t.`MASTERVALUE`=u.`ID` WHERE t.`MASTER`='TB_D_USERGROUP'
		AND
		t.DELMARK = 0
		<if test="queryMap != null and queryMap.roleid != null">
			AND t.ROLEID=#{queryMap.roleid,jdbcType=INTEGER}
		</if>
		<if test="groupname != null">
			AND u.GROUPNAME = #{groupname,jdbcType=VARCHAR} 
		</if>
	</select>


</mapper>