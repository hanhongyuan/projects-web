<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.unisk.zc.mapper.UniskUserMapper">
	<resultMap id="BaseResultMap" type="com.unisk.zc.entitys.UniskUser">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="ID" property="id" jdbcType="INTEGER" />
		<result column="USERNAME" property="username" jdbcType="VARCHAR" />
		<result column="PASSWORD" property="password" jdbcType="VARCHAR" />
		<result column="REALNAME" property="realname" jdbcType="VARCHAR" />
		<result column="SEX" property="sex" jdbcType="INTEGER" />
		<result column="PHONE" property="phone" jdbcType="VARCHAR" />
		<result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="TITLE" property="title" jdbcType="VARCHAR" />
		<result column="DEPTID" property="deptid" jdbcType="INTEGER" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="ISLOCK" property="islock" jdbcType="INTEGER" />
		<result column="DISABLETIME" property="disabletime" jdbcType="DATE" />
		<result column="STATUS" property="status" jdbcType="INTEGER" />
		<result column="DELMARK" property="delmark" jdbcType="INTEGER" />
		<result column="CREATETIME" property="createtime" jdbcType="TIMESTAMP" />
		<result column="CREATEUSERID" property="createuserid" jdbcType="INTEGER" />
		<result column="MODIFYTIME" property="modifytime" jdbcType="TIMESTAMP" />
		<result column="MODIFYUSERID" property="modifyuserid" jdbcType="INTEGER" />
		<result column="PROVID" property="provid" jdbcType="INTEGER" />
		 <result column="WECHATSTATUS" property="wechatstatus"  jdbcType="INTEGER" />
	</resultMap>
	<resultMap type="java.util.HashMap" id="pageResultMap" extends="BaseResultMap">
	</resultMap>
	<sql id="Base_Column_List">
		ID, USERNAME, PASSWORD, REALNAME, SEX, PHONE, MOBILE, EMAIL, TITLE,
		DEPTID, REMARKS,PROVID,
		ISLOCK, DISABLETIME, STATUS, DELMARK, CREATETIME,
		CREATEUSERID, MODIFYTIME,WECHATSTATUS,
		MODIFYUSERID
	</sql>
	
	<resultMap type="java.util.Map" id="PageResultMap" extends="BaseResultMap">
	</resultMap>
	
	<sql id="selectListSql">
		select
		u.ID, u.USERNAME, u.PASSWORD, u.REALNAME, u.SEX, u.PHONE, u.MOBILE, u.EMAIL, u.TITLE,
		u.DEPTID, u.REMARKS,u.PROVID,u.ISLOCK, 
		u.DISABLETIME, u.STATUS, u.DELMARK, u.CREATETIME,
		u.CREATEUSERID, u.MODIFYTIME, u.MODIFYUSERID,
		if( u.SEX = 0,'女','男') SEXLEBAL,u.WECHATSTATUS,
		(case u.WECHATSTATUS
	    	when 0 then '未同步'
	    	when 1 then '已同步'
	    	when 2 then '更新失败'
	    	when 3 then '更新成功' 
	    	else ''
	     end) WECHATSTATUSLABEL,
	    <if test="queryMap != null and queryMap.usergroupid != null">
	    ug.WECHATSTATUS  UGWECHATSTATUS,
		(case ug.WECHATSTATUS
	    	when 0 then '未同步'
	    	when 1 then '已同步'
	    	when 2 then '更新失败'
	    	when 3 then '更新成功' 
	    	else ''
	     end) UGWECHATSTATUSLABEL,
		</if>
		(select d.UKEY from TB_D_DICTIONARY d where d.UVALUE=u.PROVID and d.KINDS='COMMON-REGION') as PROVIDLABEL , 
		(select dp.DEPTNAME from TB_D_DEPARTMENT dp where dp.ID=u.DEPTID) as DEPTIDLABEL
		from TB_D_UNISKUSER u
		left join TB_D_DEPARTMENT d on d.ID = u.DEPTID
		<if test="queryMap != null and queryMap.usergroupid != null">
		left join TB_R_USER_AND_USERGROUP ug on ug.USERID=u.ID 
		</if>
		where u.DELMARK = 0
		<if test="queryMap != null and queryMap.usergroupid != null">
			and ug.USERGROUPID = #{queryMap.usergroupid,jdbcType=INTEGER}
		</if>
		<if test="deptid != null">
			and u.DEPTID = #{deptid,jdbcType=INTEGER}
		</if>
		<if test="realname != null">
			and u.REALNAME LIKE CONCAT(CONCAT('%', #{realname,jdbcType=VARCHAR}), '%')
		</if>
		<if test="username != null">
			and u.USERNAME = #{username,jdbcType=VARCHAR}
		</if>
		<if test="provid != null">
			and u.PROVID = #{provid,jdbcType=INTEGER}
		</if>
		<if test="queryMap != null and queryMap.startTime != null">
			and u.CREATETIME > #{queryMap.startTime,jdbcType=TIMESTAMP}
		</if>
		<if test="queryMap != null and queryMap.notinids != null">
			and u.id ${queryMap.notinids} 
		</if>
		order by u.CREATETIME
	</sql>
	
	<!-- 分页查询列表 -->
	<select id="selectListByPage" resultType="list" resultMap="pageResultMap"
		parameterType="com.unisk.zc.entitys.UniskUser">
		<include refid="selectListSql"></include>
	</select>
	<!-- 全量查询列表 -->
	<select id="selectList" resultType="list" resultMap="pageResultMap" parameterType="com.unisk.zc.entitys.UniskUser">
		<include refid="selectListSql"></include>
	</select>
	
	<select id="selectSelective" resultMap="BaseResultMap"
		parameterType="com.unisk.zc.entitys.UniskUser">
		select
		<include refid="Base_Column_List" />
		from TB_D_UNISKUSER
		where DELMARK = 0
		<if test="username != null">
			and USERNAME = #{username,jdbcType=VARCHAR}
		</if>
		<if test="password != null">
			and PASSWORD = #{password,jdbcType=VARCHAR}
		</if>
		<if test="provid != null">
			and PROVID = #{provid,jdbcType=INTEGER}
		</if>
		<if test="realname != null">
			and REALNAME = #{realname,jdbcType=VARCHAR}
		</if>
	</select>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from TB_D_UNISKUSER
		where ID = #{id,jdbcType=INTEGER}

	</select>
	<!-- 用户删除为逻辑删除，只是修改用户状态 -->
	<update id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		update
		TB_D_UNISKUSER set DELMARK = 1 where ID = #{id,jdbcType=INTEGER}
	</update>

	<insert id="insert" parameterType="com.unisk.zc.entitys.UniskUser"  keyProperty="id" useGeneratedKeys="true">
		insert into TB_D_UNISKUSER (ID, USERNAME, PASSWORD,
		REALNAME, SEX,
		PHONE,
		MOBILE, EMAIL, TITLE,
		DEPTID, REMARKS, ISLOCK,
		DISABLETIME,
		STATUS, DELMARK,
		CREATETIME, CREATEUSERID, MODIFYTIME,
		MODIFYUSERID,PROVID,WECHATSTATUS)
		values (#{id,jdbcType=INTEGER}, #{username,jdbcType=VARCHAR},
		#{password,jdbcType=VARCHAR},
		#{realname,jdbcType=VARCHAR},
		#{sex,jdbcType=INTEGER}, #{phone,jdbcType=VARCHAR},
		#{mobile,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
		#{title,jdbcType=VARCHAR},
		#{deptid,jdbcType=INTEGER},
		#{remarks,jdbcType=VARCHAR}, #{islock,jdbcType=INTEGER},
		#{disabletime,jdbcType=DATE}, #{status,jdbcType=INTEGER},
		#{delmark,jdbcType=INTEGER},
		#{createtime,jdbcType=TIMESTAMP},
		#{createuserid,jdbcType=INTEGER}, #{modifytime,jdbcType=TIMESTAMP},
		#{modifyuserid,jdbcType=INTEGER},#{provid,jdbcType=VARCHAR},#{wechatstatus,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.unisk.zc.entitys.UniskUser" keyProperty="id" useGeneratedKeys="true">
		insert into TB_D_UNISKUSER
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				ID,
			</if>
			<if test="username != null">
				USERNAME,
			</if>
			<if test="password != null">
				PASSWORD,
			</if>
			<if test="realname != null">
				REALNAME,
			</if>
			<if test="sex != null">
				SEX,
			</if>
			<if test="phone != null">
				PHONE,
			</if>
			<if test="mobile != null">
				MOBILE,
			</if>
			<if test="email != null">
				EMAIL,
			</if>
			<if test="title != null">
				TITLE,
			</if>
			<if test="deptid != null">
				DEPTID,
			</if>
			<if test="remarks != null">
				REMARKS,
			</if>
			<if test="islock != null">
				ISLOCK,
			</if>
			<if test="disabletime != null">
				DISABLETIME,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="delmark != null">
				DELMARK,
			</if>
			<if test="createtime != null">
				CREATETIME,
			</if>
			<if test="createuserid != null">
				CREATEUSERID,
			</if>
			<if test="modifytime != null">
				MODIFYTIME,
			</if>
			<if test="modifyuserid != null">
				MODIFYUSERID,
			</if>
			<if test="provid != null">
				PROVID,
			</if>
			<if test="wechatstatus != null">
		      	WECHATSTATUS,
		      </if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="username != null">
				#{username,jdbcType=VARCHAR},
			</if>
			<if test="password != null">
				#{password,jdbcType=VARCHAR},
			</if>
			<if test="realname != null">
				#{realname,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				#{sex,jdbcType=INTEGER},
			</if>
			<if test="phone != null">
				#{phone,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null">
				#{mobile,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="title != null">
				#{title,jdbcType=VARCHAR},
			</if>
			<if test="deptid != null">
				#{deptid,jdbcType=INTEGER},
			</if>
			<if test="remarks != null">
				#{remarks,jdbcType=VARCHAR},
			</if>
			<if test="islock != null">
				#{islock,jdbcType=INTEGER},
			</if>
			<if test="disabletime != null">
				#{disabletime,jdbcType=DATE},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
			<if test="delmark != null">
				#{delmark,jdbcType=INTEGER},
			</if>
			<if test="createtime != null">
				#{createtime,jdbcType=TIMESTAMP},
			</if>
			<if test="createuserid != null">
				#{createuserid,jdbcType=INTEGER},
			</if>
			<if test="modifytime != null">
				#{modifytime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyuserid != null">
				#{modifyuserid,jdbcType=INTEGER},
			</if>
			<if test="provid != null">
				#{provid,jdbcType=VARCHAR}
			</if>
			<if test="wechatstatus != null">
		      	#{wechatstatus,jdbcType=INTEGER},
		    </if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.unisk.zc.entitys.UniskUser">
		update TB_D_UNISKUSER
		<set>
			<if test="username != null">
				USERNAME = #{username,jdbcType=VARCHAR},
			</if>
			<if test="password != null">
				PASSWORD = #{password,jdbcType=VARCHAR},
			</if>
			<if test="realname != null">
				REALNAME = #{realname,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				SEX = #{sex,jdbcType=INTEGER},
			</if>
			<if test="phone != null">
				PHONE = #{phone,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null">
				MOBILE = #{mobile,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				EMAIL = #{email,jdbcType=VARCHAR},
			</if>
			<if test="title != null">
				TITLE = #{title,jdbcType=VARCHAR},
			</if>
			<if test="deptid != null">
				DEPTID = #{deptid,jdbcType=INTEGER},
			</if>
			<if test="remarks != null">
				REMARKS = #{remarks,jdbcType=VARCHAR},
			</if>
			<if test="islock != null">
				ISLOCK = #{islock,jdbcType=INTEGER},
			</if>
			<if test="disabletime != null">
				DISABLETIME = #{disabletime,jdbcType=DATE},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=INTEGER},
			</if>
			<if test="delmark != null">
				DELMARK = #{delmark,jdbcType=INTEGER},
			</if>
			<if test="createtime != null">
				CREATETIME = #{createtime,jdbcType=TIMESTAMP},
			</if>
			<if test="createuserid != null">
				CREATEUSERID = #{createuserid,jdbcType=INTEGER},
			</if>
			<if test="modifytime != null">
				MODIFYTIME = #{modifytime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyuserid != null">
				MODIFYUSERID = #{modifyuserid,jdbcType=INTEGER},
			</if>
			<if test="provid != null">
				PROVID = #{provid,jdbcType=VARCHAR},
			</if>
			<if test="wechatstatus != null">
		      	WECHATSTATUS = #{wechatstatus,jdbcType=INTEGER},
		    </if>
		</set>
		where ID = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.unisk.zc.entitys.UniskUser">
		update TB_D_UNISKUSER
		set USERNAME = #{username,jdbcType=VARCHAR},
		PASSWORD = #{password,jdbcType=VARCHAR},
		REALNAME = #{realname,jdbcType=VARCHAR},
		SEX = #{sex,jdbcType=INTEGER},
		PHONE = #{phone,jdbcType=VARCHAR},
		MOBILE = #{mobile,jdbcType=VARCHAR},
		EMAIL = #{email,jdbcType=VARCHAR},
		TITLE = #{title,jdbcType=VARCHAR},
		DEPTID = #{deptid,jdbcType=INTEGER},
		REMARKS = #{remarks,jdbcType=VARCHAR},
		ISLOCK = #{islock,jdbcType=INTEGER},
		DISABLETIME = #{disabletime,jdbcType=DATE},
		STATUS = #{status,jdbcType=INTEGER},
		DELMARK = #{delmark,jdbcType=INTEGER},
		CREATETIME = #{createtime,jdbcType=TIMESTAMP},
		CREATEUSERID = #{createuserid,jdbcType=INTEGER},
		MODIFYTIME = #{modifytime,jdbcType=TIMESTAMP},
		MODIFYUSERID = #{modifyuserid,jdbcType=INTEGER},
		PROVID = #{provid,jdbcType=VARCHAR},
		WECHATSTATUS = #{wechatstatus,jdbcType=INTEGER}
		where ID = #{id,jdbcType=INTEGER}
	</update>

	<select id="selectRemoveSomeUserListPage" resultType="list"
		resultMap="BaseResultMap" parameterType="com.unisk.zc.entitys.UniskUser">
		SELECT
		<include refid="Base_Column_List" />
		FROM TB_D_UNISKUSER WHERE `DELMARK`=0 AND `ID` NOT
		IN
		<if test="queryMap != null and queryMap.userGroupId != null">
			(SELECT u.`USERID`
				FROM TB_R_USER_AND_USERGROUP u WHERE u.`USERGROUPID`=#{queryMap.userGroupId,jdbcType=VARCHAR})
		</if>
		<if test="queryMap != null and queryMap.userrolesid != null">
			(SELECT u.`MASTERVALUE`
				FROM TB_R_SUBJECT_AND_ROLES u WHERE MASTER='TB_D_UNISKUSER' AND u.`ROLEID`=#{queryMap.userrolesid,jdbcType=VARCHAR})
		</if>
		<if test="realname != null">
			and REALNAME = #{realname,jdbcType=VARCHAR}
		</if>
		<if test="provid != null">
			and PROVID = #{provid,jdbcType=VARCHAR}
		</if>
		<if test="username != null">
			and USERNAME = #{username,jdbcType=VARCHAR}
		</if>
	</select>
	
	<select id="selectSubjectRolesUserListPage" resultType="list"
		resultMap="BaseResultMap" parameterType="com.unisk.zc.entitys.UniskUser">
		SELECT
		u.`USERNAME`,u.`REALNAME`,u.`EMAIL`,u.`ID`,u.`MOBILE` FROM
		TB_R_SUBJECT_AND_ROLES t LEFT JOIN TB_D_UNISKUSER u ON
		t.`MASTERVALUE`=u.`ID` WHERE t.`MASTER`='TB_D_UNISKUSER'
		and
		t.DELMARK = 0
		<if test="queryMap != null and queryMap.roleid != null">
			AND t.ROLEID=#{queryMap.roleid,jdbcType=INTEGER}
		</if>
		<if test="provid != null">
			and PROVID = #{provid,jdbcType=VARCHAR}
		</if>
		<if test="realname != null">
			AND u.REALNAME = #{realname,jdbcType=VARCHAR}
		</if>
		<if test="username != null">
			and USERNAME = #{username,jdbcType=VARCHAR}
		</if>
	</select>
	
	<!-- 根据部门ID列表查询对应的用户ID列表 -->
	<select id="selectUserIdsByDeptIds" resultType="java.lang.String" parameterType="java.util.List">
		select t.username from tb_d_uniskuser t,tb_d_department d where t.DEPTID = d.ID and d.DELMARK=0
		   and d.id in 
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
        	#{item}
  		</foreach>
	</select>
	
	<!-- 根据组ID列表查询对应的用户ID列表 -->
	<select id="selectUserIdsByTagIds" resultType="java.lang.String" parameterType="java.util.List">
		 select t.username from tb_d_uniskuser t,tb_r_user_and_usergroup d where t.id = d.USERID   and d.DELMARK=0 
		    and d.USERGROUPID in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
        	#{item}
  		</foreach>
	</select>
	
	<!-- 查询所有用户名称集合列表 -->
	<select id="selectAllUserIds" resultType="java.lang.String">
		 select t.username from tb_d_uniskuser t
	</select>
	
</mapper>